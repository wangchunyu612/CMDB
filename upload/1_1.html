<p>#!/bin/sh<br />INTERVAL=5<br />PASSWORD='-ucncn -p123456'<br />PREFIX=$INTERVAL-sec-status<br />RUNFILE=/www/logs/mysql_bench<br />mysql -e 'SHOW GLOBAL VARIABLES' $PASSWORD &gt;&gt; mysql-variables<br />while test -e $RUNFILE; do<br />&nbsp;&nbsp;&nbsp; file=$(date +%F_%I)<br />&nbsp;&nbsp;&nbsp; sleep=$(date +%s.%N | awk &quot;{print $INTERVAL - (\$1 % $INTERVAL)}&quot;)<br />&nbsp;&nbsp;&nbsp; sleep $sleep<br />&nbsp;&nbsp;&nbsp; ts=&quot;$(date + &quot;TS %s.%N %F %T&quot;)&quot;<br />&nbsp;&nbsp;&nbsp; loadavg=&quot;$(uptime)&quot;<br />&nbsp;&nbsp;&nbsp; echo &quot;$ts $loadavg&quot; &gt;&gt; $PREFIX-${file}-status<br />&nbsp;&nbsp;&nbsp; mysql -e 'SHOW GLOBAL STATUS' $PASSWORD &gt;&gt; $PREFIX-${file}-status &amp;<br />&nbsp;&nbsp;&nbsp; echo &quot;$ts $loadavg&quot; &gt;&gt; $PREFIX-${file}-innodbstatus<br />&nbsp;&nbsp;&nbsp; echo -e 'SHOW ENGINE INNODB STATUS\G' $PASSWORD &gt;&gt; $PREFIX-${file}-innodbstatus&nbsp; &amp;<br />&nbsp;&nbsp;&nbsp; echo &quot;$ts $loadavg&quot; &gt;&gt; $PREFIX-${file}-processlist<br />&nbsp;&nbsp;&nbsp; mysql -e 'SHOW FULL PROCESSLIST\G' $PASSWORD &gt;&gt; $PREFIX-${file}-processlist &amp; echo $ts<br />done<br />echo Exiting because $RUNFILE does not exist.
